include "stdtest.ph";

var bf = false;

class foo
{
    func new() ... x(123) { }
    func new(a:ref foo) ... x(a.x) { }
    func delete(){ }

    func clone():foo { return foo(this); }

    func g(a:ref foo){ test.assert(a.x == 123); bf = true;}
    func h(){ g(this); }

    var x:std.int;
}

func main()
{
    var a = foo();
    test.assert(a.x == 123);

    var b = a.clone();
    test.assert(b.x == 123);

    b.h();
    test.assert(bf);
}
