include("stdtest.ph");

class foo
{
    func new(a:ref std.int) ... x(a) { }
    func new(a:ref foo) ... x(a.x) { }
    func delete(){ }

    func clone():foo { return foo(x); }

    var x:ref std.int;
}

func f(n:ref std.int):foo
{
    var a = foo(n);
    return a.clone();
}

func main()
{
    var a = 123;
    var n = f(a);

    test.assert(n.x == 123);

    n.clone().x = 321;

    test.assert(a == 321);

    f(a).x = 456;
    test.assert(a == 456);
}
